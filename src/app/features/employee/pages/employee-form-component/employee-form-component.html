<div class="bg-white p-6 rounded shadow max-w-lg mx-auto">
  <h2 class="text-xl font-bold mb-4">
    {{ isEdit ? "Edit Employee" : "Add Employee" }}
  </h2>

  @if (form) {
  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-4">
    <app-input-text
      appAutoFocusInput
      [control]="getControl('name')"
      [label]="'Employee Name'"
      [placeholder]="'Enter name'"
    ></app-input-text>

    <app-input-select
      [control]="getControl('department')"
      [label]="'Department'"
      [placeholder]="'Select department'"
      [options]="(departmentOptions$ | async) ?? []"
    >
    </app-input-select>

    <app-input-text
      [control]="getControl('role')"
      [label]="'Role'"
      [placeholder]="'Enter role'"
    ></app-input-text>

    <app-input-date
      [control]="getControl('joiningDate')"
      [label]="'Joining Date'"
      [placeholder]="'Pick joining date'"
    ></app-input-date>

    <app-input-number
      [control]="getControl('salary')"
      [label]="'Salary'"
      [placeholder]="'Enter salary'"
      [min]="0"
    ></app-input-number>

    <div>
      <label class="block font-semibold mb-2">Profile Photo</label>

      <input
        type="file"
        accept="image/jpeg, image/png"
        (change)="onFileSelected($any($event.target).files)"
        class="block w-full text-sm text-gray-700 border border-gray-300 rounded p-2 cursor-pointer"
      />

      @if (profilePhoto.hasError('required')) {
      <mat-error>image is required</mat-error>
      } @if (selectedImagePreview) {
      <div class="mt-3">
        <img
          [src]="selectedImagePreview"
          alt="Profile preview"
          class="w-32 h-32 object-cover rounded shadow border border-gray-300"
        />
      </div>
      } @if (fileError) {
      <mat-error>{{ fileError }}</mat-error>
      }
    </div>

    <div formArrayName="experiences" class="bg-gray-50 p-4 rounded-md">
      <div class="flex justify-between items-center mb-2">
        <h3 class="font-semibold">Previous Experiences</h3>
        <button
          mat-raised-button
          color="accent"
          type="button"
          (click)="addExperience()"
        >
          + Add Experience
        </button>
      </div>

      @for (exp of experiences.controls; track exp; let i = $index) {
      <div [formGroupName]="i" class="border p-3 rounded mb-3 bg-white">
        <app-input-text
          [control]="getArrayControl('experiences', i, 'company')"
          [label]="'Company Name'"
          [placeholder]="'Enter company name'"
        ></app-input-text>

        <app-input-text
          [control]="getArrayControl('experiences', i, 'position')"
          [label]="'Position'"
          [placeholder]="'Enter position'"
        ></app-input-text>

        <app-input-number
          [control]="getArrayControl('experiences', i, 'duration')"
          [label]="'Duration (years)'"
          [placeholder]="'Enter duration'"
          [min]="1"
        ></app-input-number>

        <button
          mat-raised-button
          color="accent"
          type="button"
          (click)="removeExperience(i)"
        >
          Remove
        </button>
      </div>
      }
    </div>

    <div formArrayName="incomes" class="bg-gray-50 p-4 rounded-md">
      <div class="flex justify-between items-center mb-2">
        <h3 class="font-semibold">Income</h3>
        <button
          mat-raised-button
          color="accent"
          type="button"
          (click)="addIncome()"
        >
          + Add Income
        </button>
      </div>
      @if (getIncomeValidationError()) {
      <div
        class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-3"
      >
        <mat-error>{{ getIncomeValidationError() }}</mat-error>
      </div>
      } @for (income of incomes.controls; track income; let i = $index) {
      <div [formGroupName]="i" class="border p-3 rounded mb-3 bg-white">
        <app-input-select
          [control]="getArrayControl('incomes', i, 'frequency')"
          [label]="'Frequency'"
          [placeholder]="'Select frequency'"
          [options]="getAvailableFrequencyOptions(i)"
        ></app-input-select>

        <app-input-select
          [control]="getArrayControl('incomes', i, 'interval')"
          [label]="'Interval'"
          [placeholder]="'Enter the interval'"
          [options]="getAvailableIntervalOptions(i)"
        ></app-input-select>

        <app-input-number
          [control]="getArrayControl('incomes', i, 'amount')"
          [label]="'Amount'"
          [placeholder]="'Enter Amount'"
          [min]="1"
        ></app-input-number>

        <button
          mat-raised-button
          color="accent"
          type="button"
          (click)="removeIncome(i)"
        >
          Remove
        </button>
      </div>
      }
    </div>

    <button mat-raised-button color="primary" type="submit">
      {{ isEdit ? "Update" : "Create" }}
    </button>
  </form>
  }
</div>
