<div class="p-6">
  <h2 class="text-2xl font-semibold mb-6">Attendance Today</h2>

  <div class="mb-6">
    <button mat-raised-button color="primary" (click)="scanning = !scanning">
      {{ scanning ? "Close Scanner" : "Open Scanner" }}
    </button>

    @if (scanning) {
    <div class="mt-4">
      <zxing-scanner
        (scanSuccess)="onQrScanned($event)"
        class="block w-full max-w-md mx-auto rounded border"
      ></zxing-scanner>
    </div>
    }
  </div>

  <mat-card class="overflow-x-auto">
    @if (attendance$ | async; as attendance) {
    <table mat-table [dataSource]="attendance" class="min-w-full text-sm">
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let row">{{ row.name }}</td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let row">
          <span
            class="px-2 py-1 rounded-full text-xs"
            [ngClass]="{
              'bg-green-100 text-green-700': row.status === 'Present',
              'bg-red-100 text-red-600': row.status === 'Absent',
              'bg-yellow-100 text-yellow-700': row.status === 'On Leave'
            }"
          >
            {{ row.status }}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="timeIn">
        <th mat-header-cell *matHeaderCellDef>Time In</th>
        <td mat-cell *matCellDef="let row">{{ row.timeIn }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['name', 'status', 'timeIn']"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: ['name', 'status', 'timeIn']"
      ></tr>
    </table>
    } @else {
    <div class="p-4 text-center text-gray-500">Loading attendance...</div>
    }
  </mat-card>
</div>
